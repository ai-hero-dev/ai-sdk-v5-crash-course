# New Exercise: ToolLoopAgent (before MCP lessons)

## Overview
AI SDK v6 introduces ToolLoopAgent. Similar options to `streamText`, etc.

## system â†’ instructions

ToolLoopAgent uses `instructions` instead of `system` (aligns with OpenAI naming).

`streamText`/`generateText` still use `system`. Only ToolLoopAgent uses `instructions`.

### Polymorphic instructions

Before: string only
Now: string OR array of parts

Array of parts allows different provider options for caching:

```ts
const agent = new ToolLoopAgent({
  model: "anthropic/claude-sonnet-4.5",
  instructions: [
    { text: 'You are an expert software engineer.', providerOptions: { /* cache options */ } },
    { text: 'Additional context here.', providerOptions: { /* different cache */ } },
  ],
});
```

## Part 1: Basic ToolLoopAgent

```ts
import { ToolLoopAgent } from 'ai';

const agent = new ToolLoopAgent({
  model: "anthropic/claude-sonnet-4.5",
  instructions: 'You are an expert software engineer.',
});
```

## Part 2: API/Client Setup with createAgentUIStreamResponse

```ts
// In your API route (e.g., app/api/chat/route.ts)
import { createAgentUIStreamResponse } from 'ai';

export async function POST(request: Request) {
  const { messages } = await request.json();

  return createAgentUIStreamResponse({
    agent: myAgent,
    messages,
  });
}
```

Passes UIMessage to the agent.

## Part 3: Inferring Agent Types (agents as interfaces)

```ts
import { ToolLoopAgent, InferAgentUIMessage } from 'ai';

const myAgent = new ToolLoopAgent({
  // ... configuration
});

// Infer the UIMessage type for UI components or persistence
export type MyAgentUIMessage = InferAgentUIMessage<typeof myAgent>;
```

Use api/client setup where we need to infer shape of tools.

## Reference
- https://v6.ai-sdk.dev/docs/agents/configuring-call-options#using-with-createagentuistreamresponse

## Notes
- **Format: explainer** (not problem/solution)
- Current exercises: 03.01-03.03 (tools/frontend), 03.04-03.05 (MCP)
- This should slot in before MCP (maybe 03.04, renumber MCP to 03.05-03.06)
- api/client setup where we need to infer shape of tools
